{% extends "base.html" %}

{% block title %}Strategy Generation - Sales Strategist{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h1 class="mb-4">Strategy Generation</h1>
        <p class="lead">Generate optimal pricing and sales strategies with intelligent recommendations</p>
    </div>
</div>

<!-- Alert Container -->
<div id="alertContainer"></div>

<!-- Input Section -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card shadow-sm">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0"><i class="bi bi-sliders"></i> Market State Configuration</h5>
            </div>
            <div class="card-body">
                <form id="strategyForm">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="marketDemand" class="form-label">Market Demand</label>
                            <input type="range" class="form-range" id="marketDemand" 
                                   min="0" max="1" step="0.01" value="0.7">
                            <div class="form-text">Current: <span id="marketDemandValue">0.70</span></div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="salesVolume" class="form-label">Sales Volume</label>
                            <input type="range" class="form-range" id="salesVolume" 
                                   min="0" max="1" step="0.01" value="0.6">
                            <div class="form-text">Current: <span id="salesVolumeValue">0.60</span></div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="conversionRate" class="form-label">Conversion Rate</label>
                            <input type="range" class="form-range" id="conversionRate" 
                                   min="0" max="1" step="0.01" value="0.5">
                            <div class="form-text">Current: <span id="conversionRateValue">0.50</span></div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="inventoryLevel" class="form-label">Inventory Level</label>
                            <input type="range" class="form-range" id="inventoryLevel" 
                                   min="0" max="1" step="0.01" value="0.8">
                            <div class="form-text">Current: <span id="inventoryLevelValue">0.80</span></div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="marketTrend" class="form-label">Market Trend</label>
                            <input type="range" class="form-range" id="marketTrend" 
                                   min="-1" max="1" step="0.01" value="0.2">
                            <div class="form-text">Current: <span id="marketTrendValue">0.20</span></div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="competitorPrices" class="form-label">Competitor Prices (comma-separated)</label>
                            <input type="text" class="form-control" id="competitorPrices" 
                                   value="0.5, 0.6, 0.7" placeholder="0.5, 0.6, 0.7">
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="includeExplanation" checked>
                            <label class="form-check-label" for="includeExplanation">
                                Include LLM-generated explanation
                            </label>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-success btn-lg">
                        <i class="bi bi-lightbulb-fill"></i> Generate Strategy
                    </button>
                    <button type="button" class="btn btn-secondary btn-lg" onclick="loadPresetScenario()">
                        <i class="bi bi-file-earmark-text"></i> Load Preset
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Results Section -->
<div id="resultsSection" style="display: none;">
    <!-- Recommendations Card -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card shadow-sm border-success">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0"><i class="bi bi-check-circle"></i> Strategy Recommendations</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="metric-card">
                                <p class="metric-label">Price Adjustment</p>
                                <h2 class="metric-value" id="priceAdjustment">-</h2>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="metric-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                                <p class="metric-label">Sales Approach</p>
                                <h2 class="metric-value" id="salesApproach">-</h2>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="metric-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                                <p class="metric-label">Promotion Intensity</p>
                                <h2 class="metric-value" id="promotionIntensity">-</h2>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <h6>Confidence Score</h6>
                        <div class="confidence-bar">
                            <div id="confidenceBar" class="confidence-fill" style="width: 0%"></div>
                        </div>
                        <p class="mt-2">
                            <span class="badge badge-lg" id="confidenceBadge">-</span>
                            <span id="confidenceScore" class="ms-2">-</span>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Strategy Explanation -->
    <div id="explanationSection" class="row mb-4" style="display: none;">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0"><i class="bi bi-chat-left-text"></i> Strategy Explanation</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <h6><i class="bi bi-file-text"></i> Summary</h6>
                        <p id="explanationSummary" class="text-muted">-</p>
                    </div>
                    <div class="mb-3">
                        <h6><i class="bi bi-lightbulb"></i> Rationale</h6>
                        <p id="explanationRationale" class="text-muted">-</p>
                    </div>
                    <div class="mb-3">
                        <h6><i class="bi bi-graph-up-arrow"></i> Expected Outcomes</h6>
                        <p id="explanationOutcomes" class="text-muted">-</p>
                    </div>
                    <div class="mb-3">
                        <h6><i class="bi bi-exclamation-triangle"></i> Risks</h6>
                        <p id="explanationRisks" class="text-muted">-</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Revenue Forecast Chart -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="bi bi-graph-up"></i> Revenue Forecast</h5>
                </div>
                <div class="card-body">
                    <canvas id="revenueForecastChart" class="chart-container-lg"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Performance Heatmap -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header bg-warning text-white">
                    <h5 class="mb-0"><i class="bi bi-grid-3x3"></i> Strategy Performance Heatmap</h5>
                </div>
                <div class="card-body">
                    <div id="performanceHeatmap" class="chart-container-lg"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Actionable Insights -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header bg-danger text-white">
                    <h5 class="mb-0"><i class="bi bi-list-check"></i> Actionable Insights</h5>
                </div>
                <div class="card-body">
                    <ul id="actionableInsightsList" class="list-group">
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Scenario Comparison Modal -->
<div class="modal fade" id="comparisonModal" tabindex="-1" aria-labelledby="comparisonModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="comparisonModalLabel">Strategy Comparison</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="comparisonModalBody">
                <canvas id="comparisonChart"></canvas>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="{{ url_for('dashboard.static', filename='js/strategy.js') }}"></script>
{% endblock %}
